<!DOCTYPE html>
<html
  lang="en"
  theme="light"
>
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  


<link
  rel="preload"
  as="font"
  type="font/woff2"
  href="/fonts/roboto-slab-latin-400.woff2"
  crossorigin="anonymous"
/>
<link
  rel="prefetch"
  as="font"
  type="font/woff2"
  href="/fonts/roboto-slab-latin-700.woff2"
  crossorigin="anonymous"
/>


<link
  rel="preload"
  as="font"
  type="font/woff2"
  href="/fonts/fira-code-latin-300.woff2"
  crossorigin="anonymous"
/>
<link
  rel="preload"
  as="font"
  type="font/woff2"
  href="/fonts/fira-code-latin-400.woff2"
  crossorigin="anonymous"
/>
<link
  rel="prefetch"
  as="font"
  type="font/woff2"
  href="/fonts/fira-code-latin-700.woff2"
  crossorigin="anonymous"
/>

  
  
    <meta
      name="robots"
      content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"
    />
  



<title>OPA Gatekeeper on OpenShift</title>

<meta
  name="description"
  content="OpenShift policy management with opa gatekeeper"
/>

<link rel="canonical" href="https://vikaspogu.dev/blog/opa-gatekeeper-openshift/" />



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="OPA Gatekeeper on OpenShift"/>
<meta name="twitter:description" content="OpenShift policy management with opa gatekeeper"/>

<meta property="og:title" content="OPA Gatekeeper on OpenShift" />
<meta property="og:description" content="OpenShift policy management with opa gatekeeper" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://vikaspogu.dev/blog/opa-gatekeeper-openshift/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2020-08-18T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-08-18T00:00:00+00:00" />


<meta itemprop="name" content="OPA Gatekeeper on OpenShift">
<meta itemprop="description" content="OpenShift policy management with opa gatekeeper"><meta itemprop="datePublished" content="2020-08-18T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-08-18T00:00:00+00:00" />
<meta itemprop="wordCount" content="648">
<meta itemprop="keywords" content="OpenShift,opa,gatekeeper," />








  
  


  








  
  
  
  


<style>
   
  @font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:100;src:local("Roboto Slab Thin "),local("Roboto Slab-Thin"),url(/fonts/roboto-slab-latin-100.woff2) format("woff2"),url(/fonts/roboto-slab-latin-100.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:200;src:local("Roboto Slab Extra Light "),local("Roboto Slab-Extra Light"),url(/fonts/roboto-slab-latin-200.woff2) format("woff2"),url(/fonts/roboto-slab-latin-200.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:300;src:local("Roboto Slab Light "),local("Roboto Slab-Light"),url(/fonts/roboto-slab-latin-300.woff2) format("woff2"),url(/fonts/roboto-slab-latin-300.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:400;src:local("Roboto Slab Regular "),local("Roboto Slab-Regular"),url(/fonts/roboto-slab-latin-400.woff2) format("woff2"),url(/fonts/roboto-slab-latin-400.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:500;src:local("Roboto Slab Medium "),local("Roboto Slab-Medium"),url(/fonts/roboto-slab-latin-500.woff2) format("woff2"),url(/fonts/roboto-slab-latin-500.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:600;src:local("Roboto Slab SemiBold "),local("Roboto Slab-SemiBold"),url(/fonts/roboto-slab-latin-600.woff2) format("woff2"),url(/fonts/roboto-slab-latin-600.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:700;src:local("Roboto Slab Bold "),local("Roboto Slab-Bold"),url(/fonts/roboto-slab-latin-700.woff2) format("woff2"),url(/fonts/roboto-slab-latin-700.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:800;src:local("Roboto Slab ExtraBold "),local("Roboto Slab-ExtraBold"),url(/fonts/roboto-slab-latin-800.woff2) format("woff2"),url(/fonts/roboto-slab-latin-800.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:900;src:local("Roboto Slab Black "),local("Roboto Slab-Black"),url(/fonts/roboto-slab-latin-900.woff2) format("woff2"),url(/fonts/roboto-slab-latin-900.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:300;src:local("Fira Code Light "),local("Fira Code-Light"),url(/fonts/fira-code-latin-300.woff2) format("woff2"),url(/fonts/fira-code-latin-300.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:400;src:local("Fira Code Regular "),local("Fira Code-Regular"),url(/fonts/fira-code-latin-400.woff2) format("woff2"),url(/fonts/fira-code-latin-400.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:500;src:local("Fira Code Medium "),local("Fira Code-Medium"),url(/fonts/fira-code-latin-500.woff2) format("woff2"),url(/fonts/fira-code-latin-500.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:600;src:local("Fira Code SemiBold "),local("Fira Code-SemiBold"),url(/fonts/fira-code-latin-600.woff2) format("woff2"),url(/fonts/fira-code-latin-600.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:700;src:local("Fira Code Bold "),local("Fira Code-Bold"),url(/fonts/fira-code-latin-700.woff2) format("woff2"),url(/fonts/fira-code-latin-700.woff) format("woff")}

/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}:root[theme=light]{--bg:var(--bg0);--bg0:#fbf1c7;--bg0_h:#f9f5d7;--bg0_s:#f2e5bc;--bg1:#ebdbb2;--bg2:#d5c4a1;--bg3:#bdae93;--bg4:#a89984;--fg:var(--fg1);--fg0:#282828;--fg1:#3c3836;--fg2:#504945;--fg3:#665c54;--fg4:#7c6f64;--gray1:var(--fg4);--gray2:#928374;--red1:#cc241d;--red2:#9d0006;--green1:#98971a;--green2:#797403;--yellow1:#d79921;--yellow2:#b57614;--blue1:#458588;--blue2:#076678;--purple1:#b16286;--purple2:#8f3f71;--aqua1:#689d6a;--aqua2:#427b58;--orange1:#d65d0e;--orange2:#af3a03}[theme=light]:root .light--hidden{display:none}:root[theme=dark]{--bg:var(--bg0);--bg0:#282828;--bg0_h:#1d2021;--bg0_s:#32302f;--bg1:#3c3836;--bg2:#504945;--bg3:#665c54;--bg4:#7c6f64;--fg:var(--fg1);--fg0:#fbf1c7;--fg1:#ebdbb2;--fg2:#d5c4a1;--fg3:#bdae93;--fg4:#a89984;--gray1:var(--fg4);--gray2:#928374;--red1:#cc241d;--red2:#fb4934;--green1:#98971a;--green2:#b8bb26;--yellow1:#d79921;--yellow2:#fabd2f;--blue1:#458588;--blue2:#83a598;--purple1:#b16286;--purple2:#d3869b;--aqua1:#689d6a;--aqua2:#8ec07c;--orange1:#d65d0e;--orange2:#fe8019}[theme=dark]:root .dark--hidden{display:none}:root{--primary:var(--blue1);--primary-alt:var(--blue2);--font-monospace:"Fira Code","Lucida Console",Monaco,monospace;--font-sans-serif:Verdana,Helvetica,sans-serif;--font-serif:"Roboto Slab",Georgia,serif}html{font-family:Roboto Slab,Georgia,serif;font-family:var(--font-serif);font-size:1rem;scroll-behavior:smooth}body{word-wrap:break-word;background:var(--bg);color:var(--fg);line-height:1.675}strong{letter-spacing:.35px}a{color:inherit;text-decoration:none}a.link--external:after{content:"\2009↗"}img{border:2px solid var(--bg1);height:auto;max-width:100%}figure{display:inline-block}figcaption{color:var(--fg3);font-family:Roboto Slab,Georgia,serif;font-family:var(--font-serif);font-size:.9rem}::-moz-selection{background:var(--bg4);color:var(--fg0)}::selection{background:var(--bg4);color:var(--fg0)}h1,h2,h3,h4{color:var(--fg0);font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace);font-weight:300;line-height:1.4}h1 code,h2 code,h3 code,h4 code{font-size:1em}h2,h3,h4{border-bottom:1px solid var(--bg1)}h1,h2{font-weight:400}h1{font-size:1.875rem}h2{font-size:1.75rem}h3{font-size:1.625rem}@media (min-width:768px){h1{font-size:2.375rem}h2{font-size:2rem}h3{font-size:1.75rem}}h4{font-size:1.5rem}hr{background:var(--bg1);border:none;height:1px;margin:3rem auto;width:80%}blockquote,code,pre{border-radius:.2rem;padding:0 .2em}pre code{padding:0}blockquote,code,pre{background:var(--bg1)}code,pre{font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace)}code code{background:var(--bg2)}blockquote,pre{padding:1rem}pre{background:var(--bg1)!important;overflow:auto}pre code{background:none}blockquote{border-left:5px solid var(--primary-alt);margin:.5rem 0}blockquote:not(.does-not-exist) code{background:var(--bg2)}blockquote:not(.does-not-exist) p:first-of-type{margin-top:0}blockquote:not(.does-not-exist) p:last-of-type{margin-bottom:0}pre::-webkit-scrollbar{height:.5rem;scrollbar-width:auto}pre::-webkit-scrollbar-track{background:var(--bg2);border-radius:.2rem}pre::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:.2rem}.layout{display:grid;grid-template-areas:"header" "main" "footer";grid-template-rows:auto 1fr auto;height:100vh}main{align-items:start;display:grid;grid-area:main;grid-template-areas:"empty content sidebar";grid-template-columns:1fr minmax(0,650px) 4fr}header{background:var(--bg1);grid-area:header}footer{grid-area:footer}footer,main{margin:.5em 1.1em}.content{grid-area:content}.sidebar{display:none;flex-direction:column;grid-area:sidebar;margin-top:3rem;position:-webkit-sticky;position:sticky;top:2rem}@media (min-width:992px){.sidebar{display:flex}}header{display:grid;font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace);font-size:1.125rem;grid-template-areas:"heading search nav theme-toggle";grid-template-columns:auto auto 1fr auto;padding:.75rem}.logo{color:var(--fg0);display:flex;font-weight:700;grid-area:heading}.logo:hover .logo__cursor{-webkit-animation:blink 1s infinite;animation:blink 1s infinite;opacity:1}.logo__chevron,.logo__cursor{margin-left:.5rem}.logo__cursor{opacity:0}.logo__text{display:none}@media (min-width:768px){.logo__text{display:block}}.search{display:flex;grid-area:search;margin:0 1rem}#search__text{background:var(--bg2);border:1px solid var(--bg2);border-radius:.2rem;caret-color:var(--fg);color:var(--fg);outline:none;padding:0 .5rem;width:100%}#search__text:hover{border-color:var(--bg3)}#search__text:focus{border-color:var(--bg4)}#search__text::-moz-placeholder{color:var(--fg3)}#search__text::placeholder{color:var(--fg3)}#search__text[type=search]::-webkit-search-cancel-button{-webkit-appearance:none;appearance:none}#search__suggestions{background:var(--bg);border-radius:.2rem;box-shadow:0 .5rem 1rem var(--bg1);font-family:Roboto Slab,Georgia,serif;font-family:var(--font-serif);left:0;margin-top:2rem;position:absolute;width:95vw;z-index:1000}@media (min-width:768px){.search{position:relative}#search__suggestions{width:60vw}}.search__suggestions--hidden{display:none}.search__suggestion-item{border-bottom:1px dashed var(--bg2);display:grid;grid-template-columns:1fr 2fr}.search__suggestion-item.focus-visible,.search__suggestion-item:focus,.search__suggestion-item:hover{background:var(--bg1);cursor:pointer;outline:none}.search__suggestion-item:focus,.search__suggestion-item:focus-visible,.search__suggestion-item:hover{background:var(--bg1);cursor:pointer;outline:none}.search__suggestion-item:last-child{border:none}.search__suggestion-description,.search__suggestion-title{margin:1rem 0;padding:0 1rem}.search__suggestion-title{font-weight:700}.search__suggestion-description{border-left:1px solid var(--bg2)}.search__no-results{padding:.75rem}.theme__toggle{align-items:center;background:none;border:none;color:var(--yellow1);cursor:pointer;display:flex;grid-area:theme-toggle;margin:0 1rem}.theme__toggle:hover{color:var(--yellow2)}.theme__toggle svg{height:28px;width:28px}nav#menu{align-items:center;display:flex;grid-area:nav;justify-content:flex-end}nav#menu .menu__item{color:var(--fg)}nav#menu .menu__item:hover{color:var(--fg3);cursor:pointer}nav#menu ul{list-style:none;margin:0;padding:0}nav#menu ul.menu--horizontal{align-items:center;display:none}nav#menu ul.menu--horizontal li{display:inline-block;margin:0 .75rem}@media (min-width:768px){nav#menu ul.menu--horizontal{display:flex}}nav#menu ul.menu--vertical{background:var(--fg0);bottom:0;margin:0;padding:3rem;position:fixed;right:0;top:0;transform:translate(100%);transition:transform .5s cubic-bezier(.9,0,.1,1);width:50%;z-index:10}nav#menu ul.menu--vertical .menu__item{color:var(--bg1)}nav#menu ul.menu--vertical .menu__item:hover{color:var(--bg4)}nav#menu .menu__burger{display:flex;height:24px;width:24px}nav#menu .menu__burger>*{position:absolute}nav#menu .menu__burger svg{height:inherit;width:inherit;z-index:20}nav#menu .menu__burger svg line{transition-duration:.5s;transition-property:stroke,opacity,transform;transition-timing-function:cubic-bezier(.9,0,.1,1)}nav#menu .menu__burger svg line:first-of-type{transform-origin:center 6px}nav#menu .menu__burger svg line:nth-of-type(2){transform-origin:center 12px}nav#menu .menu__burger svg line:nth-of-type(3){transform-origin:center 18px}nav#menu .menu__burger input{height:inherit;opacity:0;width:inherit;z-index:30}:is(nav#menu .menu__burger input:checked)~ul.menu--vertical{transform:none}:is(nav#menu .menu__burger input:checked)~svg{stroke:var(--bg1)}:is(nav#menu .menu__burger input:checked)~svg line:first-of-type{transform:translateY(6px) rotate(45deg)}:is(nav#menu .menu__burger input:checked)~svg line:nth-of-type(2){opacity:0;transform:scale(.2)}:is(nav#menu .menu__burger input:checked)~svg line:nth-of-type(3){transform:translateY(-6px) rotate(-45deg)}@media (min-width:768px){nav#menu .menu__burger{display:none}}

/*! Source: https://stackoverflow.com/a/36118384/1154965 */@-webkit-keyframes blink{50%{opacity:0}to{opacity:1}}@keyframes blink{50%{opacity:0}to{opacity:1}}.sidebar{font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace);margin-left:auto;margin-right:auto;max-width:350px;padding-left:2.5rem}.sidebar svg{fill:var(--fg)}.jr-basics__image{background:var(--bg1);border:2px solid var(--bg2)}.jr-basics__summary{color:var(--fg3);font-family:Roboto Slab,Georgia,serif;font-family:var(--font-serif);margin:.75rem 0}.jr-basics__profile a:hover{color:var(--fg3)}.jr-basics__profile a:hover svg{fill:var(--fg3)}.post{border-bottom:2px dotted var(--bg1);padding:2rem 0}.post figure,.post img:not(figure img){box-sizing:border-box;margin:.5rem 0}.post-content__read-more,.post-header{font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace)}.post-content{margin:1.3rem 0}.post-content__read-more{margin-top:1.3rem}.post-content a,.post-content__read-more,.post-header a{color:var(--blue2);color:var(--primary-alt)}.post-content a:hover,.post-header a:hover{color:var(--blue1);color:var(--primary)}.post-tags{align-items:center;display:flex;flex-wrap:wrap;gap:.9rem;margin:1rem 0}.post-tag{font-size:.9rem;line-height:1}.post-tag:before{content:"#"}.post-heading__anchor{display:none}h1:hover .post-heading__anchor,h2:hover .post-heading__anchor,h3:hover .post-heading__anchor,h4:hover .post-heading__anchor{display:inline-block}.jr__item-meta{flex-direction:column}.jr-basics__image,.jr-basics__item,.jr-basics__profile-icon,.jr-basics__profile-item,.jr__item-meta{align-items:center;display:flex}.jr-basics__name,.jr-certificates__name,.jr-education__area,.jr-work__position{font-size:1.125rem;font-weight:700}.jr-basics__item{flex-direction:column;text-align:center}.jr-basics__item hr{margin:1.5rem auto}.jr-basics__image{border-radius:50%;height:250px;justify-content:center;overflow:hidden;width:250px}.jr-basics__label,.jr-basics__name,.jr-basics__summary{margin-top:.75rem}.jr-basics__profile svg{height:24px;width:24px}.jr-basics__profile,.jr-basics__profile-item{display:flex}.jr-basics__profile-item{display:flex;padding:.2rem}.jr-basics__profile--col{flex-direction:column}.jr-basics__profile-icon{padding:0 .75rem}.jr__item-meta{align-items:start;flex-flow:column;font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace)}@media (min-width:768px){.jr__item-meta{align-items:center;flex-flow:row wrap}.jr-work__location,.jr__date-range{flex-grow:1;text-align:right}.jr-education__institution{flex-basis:100%}}
   
</style>

<link
  rel="preload"
  href="/css/non-critical.f67aefdd3191adb1c6e4b37bfbc0a254a8dc0816623d76a2d22160692d4abecf0ba11b28bbd577706969ec49af9d0775bedde87d55848b3276d6f261d689c960.css"
  as="style"
  onload="this.onload=null;this.rel='stylesheet'"
  integrity="sha512-9nrv3TGRrbHG5LN7+8CiVKjcCBZiPXai0iFgaS1Kvs8LoRsou9V3cGlp7EmvnQd1vt3ofVWEizJ21vJh1onJYA=="
/>

<link
  id="prism-dark"
  rel="prefetch"
  href="/prism-themes/prism-gruvbox-dark.min.54aecc64074623a4f9898544dcbdab9e804f1560ef0b38f4cf8e10fcaaf72264e798cb407c601aca6ecd833ec4eb93d66535581f18d45ba202cf848b70dbc332.css"
  as="style"
  onload="this.onload=null;this.rel='stylesheet'"
  integrity="sha512-VK7MZAdGI6T5iYVE3L2rnoBPFWDvCzj0z44Q/Kr3ImTnmMtAfGAaym7Ngz7E65PWZTVYHxjUW6ICz4SLcNvDMg=="
  disabled
/>

<link
  id="prism-light"
  rel="prefetch"
  href="/prism-themes/prism-gruvbox-light.min.42a221741efe997fcc94187c39d63c555560678789ac9ca856c74a5f0ddb2aa6c50d38b2ffbecc7a99038cbbd2efa99746e862267f781c559e0cfec10b88a5fc.css"
  as="style"
  onload="this.onload=null;this.rel='stylesheet'"
  integrity="sha512-QqIhdB7&#43;mX/MlBh8OdY8VVVgZ4eJrJyoVsdKXw3bKqbFDTiy/77MepkDjLvS76mXRuhiJn94HFWeDP7BC4il/A=="
  
/>

<noscript>
  
    <link
      rel="stylesheet"
      href="/prism-themes/prism-gruvbox-light.min.42a221741efe997fcc94187c39d63c555560678789ac9ca856c74a5f0ddb2aa6c50d38b2ffbecc7a99038cbbd2efa99746e862267f781c559e0cfec10b88a5fc.css"
      integrity="sha512-QqIhdB7&#43;mX/MlBh8OdY8VVVgZ4eJrJyoVsdKXw3bKqbFDTiy/77MepkDjLvS76mXRuhiJn94HFWeDP7BC4il/A=="
    />
  

  <link
    rel="stylesheet"
    href="/css/non-critical.f67aefdd3191adb1c6e4b37bfbc0a254a8dc0816623d76a2d22160692d4abecf0ba11b28bbd577706969ec49af9d0775bedde87d55848b3276d6f261d689c960.css"
    integrity="sha512-9nrv3TGRrbHG5LN7+8CiVKjcCBZiPXai0iFgaS1Kvs8LoRsou9V3cGlp7EmvnQd1vt3ofVWEizJ21vJh1onJYA=="
  />
</noscript>


  

  




<script>
  (()=>{function c(){if(localStorage&&localStorage.getItem("theme"))return localStorage.getItem("theme");if(window.matchMedia)return window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}function n(t){document.documentElement.setAttribute("theme",t);let e=document.getElementById("prism-dark"),i=document.getElementById("prism-light");e.toggleAttribute("disabled",t==="light"),i.toggleAttribute("disabled",t==="dark"),localStorage.setItem("theme",t)}var o=c();o&&n(o);function l(t){let e=t.currentTarget.classList.contains("light--hidden")?"light":"dark";n(e)}document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".theme__toggle").forEach(e=>{e.addEventListener("click",l)})});})();

</script>


  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
<link rel="manifest" href="/site.webmanifest" />
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#282828" />
<meta name="msapplication-TileColor" content="#282828" />
<meta name="theme-color" content="#282828" />



  
  

</head>

  <body>
    <div class="layout">
      <header>
  <a
    class="logo"
    href="/"
  >
    
      <div class="logo__text">My approach...</div>
    
    <div class="logo__chevron">></div>
    <div class="logo__cursor">█</div>
  </a>

  <div class="search">
    <input
      id="search__text"
      type="search"
      placeholder="Search..."
      aria-label="Search"
      autocomplete="off"
    />
    <div id="search__suggestions" class="search__suggestions--hidden"></div>
  </div>

  <nav id="menu">
    <ul class="menu--horizontal">
      
        <li class="menu__item">
          <a href="/blog">Blog</a>
        </li>
      
        <li class="menu__item">
          <a href="/cv">CV</a>
        </li>
      
        <li class="menu__item">
          <a href="/about">About</a>
        </li>
      
    </ul>

    <div class="menu__burger">
      
      <input class="menu__item" type="checkbox" aria-label="Open main menu" />

      
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <line x1="4" y1="6" x2="20" y2="6" />
  <line x1="4" y1="12" x2="20" y2="12" />
  <line x1="4" y1="18" x2="20" y2="18" />
</svg>







      <ul class="menu--vertical">
        
          <li>
            <a class="menu__item" href="/blog">Blog</a>
          </li>
        
          <li>
            <a class="menu__item" href="/cv">CV</a>
          </li>
        
          <li>
            <a class="menu__item" href="/about">About</a>
          </li>
        
      </ul>
    </div>
  </nav>

  <button class="theme__toggle light--hidden" aria-label="Toggle light mode">
    
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <circle cx="12" cy="12" r="4" />
  <path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7" />
</svg>





  </button>

  <button class="theme__toggle dark--hidden" aria-label="Toggle dark mode">
    
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
</svg>





  </button>
</header>

      <main>
        <div class="content">
          
  <article class="post">
    <div class="post-header">
  <h1>
    <a href="/blog/opa-gatekeeper-openshift/">OPA Gatekeeper on OpenShift</a>
  </h1>

  <div class="post-meta">
    
      <span>2020-08-18</span>
    
    
    
    
    
    
      <div class="post-tags">
        
          <a
            class="post-tag"
            href="https://vikaspogu.dev/tags/openshift"
          >openshift</a>
        
          <a
            class="post-tag"
            href="https://vikaspogu.dev/tags/opa"
          >opa</a>
        
          <a
            class="post-tag"
            href="https://vikaspogu.dev/tags/gatekeeper"
          >gatekeeper</a>
        
      </div>
    

    
  </div>
</div>

    <div class="post-content">
      <p>Every organization has policies. Some are essential to meet governance and legal requirements. Others help ensure adherence to best practices and institutional conventions. Attempting to ensure compliance manually would be error-prone and frustrating</p>
<p>OPA lets you specific policy as code using OPA policy language <a
  href="https://www.openpolicyagent.org/docs/latest/policy-language/"
  
  
    class="link--external" target="_blank" rel="noreferrer"
  
>Rego</a></p>
<p>In this post, I&rsquo;ll share my experience deploying OPA <a
  href="https://github.com/open-policy-agent/gatekeeper"
  
  
    class="link--external" target="_blank" rel="noreferrer"
  
>Gatekeeper</a> on OpenShift and creating few policies for demonstartions. This post is not an introduction to OPA, <a
  href="https://www.magalix.com/blog/introducing-policy-as-code-the-open-policy-agent-opa"
  
  
    class="link--external" target="_blank" rel="noreferrer"
  
>refer to</a> for intro</p>
<p>Gatekeeper introduces native kubernetes CRDs for instantiating policies</p>
<h2 id="installation">
  Installation
  <a href="#installation" class="post-heading__anchor" aria-hidden="true">#</a>
</h2>
<p>For installation, make sure you have cluster admin permissions</p>
<p>Let&rsquo;s start by adding the <code>admission.gatekeeper.sh/ignore</code> label to non-user namespaces, so that all the resources in the labeled project are exempted from admission webhook</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>oc login --token<span style="color:#f92672">=</span>l4xjpLh0e722B2_i7iWAbPsUNOb6vPDaAXnqhH563oU --server<span style="color:#f92672">=</span>https://api.cluster-1d4d.sandbox702.opentlc.com:6443
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> namespace in <span style="color:#66d9ef">$(</span>oc get namespaces -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{.items[*].metadata.name}&#39;</span> | xargs<span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>namespace<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span>~ OpenShift.* <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>namespace<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span>~ kube.* <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>namespace<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span>~ default <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    oc patch namespace/<span style="color:#e6db74">${</span>namespace<span style="color:#e6db74">}</span> -p<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{&#34;metadata&#34;:{&#34;labels&#34;:{&#34;admission.gatekeeper.sh/ignore&#34;:&#34;true&#34;}}}&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Probably a users project, so leave it alone</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Skipping: </span><span style="color:#e6db74">${</span>namespace<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><h3 id="deploying-a-release-using-prebuilt-image">
  Deploying a Release using Prebuilt Image
  <a href="#deploying-a-release-using-prebuilt-image" class="post-heading__anchor" aria-hidden="true">#</a>
</h3>
<p>Deploy Gatekeeper with prebuilt image</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>oc apply -f https://raw.githubusercontent.com/open-policy-agent/gatekeeper/master/deploy/gatekeeper.yaml
</span></span></code></pre></div><p>Remove securityContext and annotations from the deployments</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>oc patch Deployment/gatekeeper-audit --type json -p<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;[{&#34;op&#34;: &#34;remove&#34;, &#34;path&#34;: &#34;/spec/template/metadata/annotations&#34;}]&#39;</span> -n gatekeeper-system
</span></span><span style="display:flex;"><span>oc patch Deployment/gatekeeper-controller-manager --type json -p<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;[{&#34;op&#34;: &#34;remove&#34;, &#34;path&#34;: &#34;/spec/template/metadata/annotations&#34;}]&#39;</span> -n gatekeeper-system
</span></span><span style="display:flex;"><span>oc patch Deployment/gatekeeper-audit --type json --patch <span style="color:#e6db74">&#39;[{ &#34;op&#34;: &#34;remove&#34;, &#34;path&#34;: &#34;/spec/template/spec/containers/0/securityContext&#34; }]&#39;</span> -n gatekeeper-system
</span></span><span style="display:flex;"><span>oc patch Deployment/gatekeeper-controller-manager --type json --patch <span style="color:#e6db74">&#39;[{ &#34;op&#34;: &#34;remove&#34;, &#34;path&#34;: &#34;/spec/template/spec/containers/0/securityContext&#34; }]&#39;</span> -n gatekeeper-system
</span></span></code></pre></div><p>Wait for Gatekeeper to be ready</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>oc get pods -n gatekeeper-system
</span></span><span style="display:flex;"><span>NAME                                            READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>gatekeeper-audit-7c84869dbf-r5p87               1/1     Running   <span style="color:#ae81ff">0</span>          2m34s
</span></span><span style="display:flex;"><span>gatekeeper-controller-manager-ff58b6688-9tbxx   1/1     Running   <span style="color:#ae81ff">0</span>          3m23s
</span></span><span style="display:flex;"><span>gatekeeper-controller-manager-ff58b6688-njfnd   1/1     Running   <span style="color:#ae81ff">0</span>          2m54s
</span></span><span style="display:flex;"><span>gatekeeper-controller-manager-ff58b6688-vlrsl   1/1     Running   <span style="color:#ae81ff">0</span>          3m11s
</span></span></code></pre></div><p>Gatekeeper uses the <a
  href="https://github.com/open-policy-agent/frameworks/tree/master/constraint"
  
  
    class="link--external" target="_blank" rel="noreferrer"
  
>OPA Constraint Framework</a> to describe and enforce policy</p>
<h3 id="defining-constraints">
  Defining constraints
  <a href="#defining-constraints" class="post-heading__anchor" aria-hidden="true">#</a>
</h3>
<p>Constraints can be defined by creating a CRD (CustomResourceDefinition) with the template of the constraint you want. Let’s look at a template which enforces that only secure routes are created in the cluster</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">templates.gatekeeper.sh/v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ConstraintTemplate</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">k8sallowedroutes</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">crd</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">names</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">K8sAllowedRoutes</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">targets</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">target</span>: <span style="color:#ae81ff">admission.k8s.gatekeeper.sh</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">rego</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        package k8sallowedroutes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        violation[{&#34;msg&#34;: msg}] {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          not input.review.object.spec.tls
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          msg := sprintf(&#34;&#39;%v&#39; route must be a secured route. non secured routes are not permitted&#34;, [input.review.object.metadata.name])
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }</span>        
</span></span></code></pre></div><p>It will get the route and check if <code>tls</code> object is specified. If this is not true, the violation block continues and the violation is triggered with the corresponding message</p>
<h3 id="enforcing-constraints">
  Enforcing constraints
  <a href="#enforcing-constraints" class="post-heading__anchor" aria-hidden="true">#</a>
</h3>
<p>These constrains which you defined now need to be enforced. This is done by defining a constraint which will use the template specified earlier.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">constraints.gatekeeper.sh/v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">K8sAllowedRoutes</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">secure-route</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">match</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kinds</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;route.OpenShift.io&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kinds</span>: [<span style="color:#e6db74">&#34;Route&#34;</span>]
</span></span></code></pre></div><p>This policy will use the CRD “K8sAllowedRoutes” which we had already defined. Matching is done by specifying on which API group it has to be enforced</p>
<p>



  
  
  
  
  
  
    
    
    
    
    
    

    
    
    
      
        
        
        
          
          
          
        
      
    
      
        
        
        
          
          
          
        
      
    
      
        
        
        
          
          
          
        
      
    
      
        
        
        
          
          
          
        
      
    
      
        
        
        
          
          
          
        
      
    


    <picture>
      
        <source srcset="/blog/opa-gatekeeper-openshift/nonsecure-route_hub1aa6be75d3487a19b298ae38ebb6c09_22483_100x0_resize_q75_h2_box_3.webp 100w,/blog/opa-gatekeeper-openshift/nonsecure-route_hub1aa6be75d3487a19b298ae38ebb6c09_22483_200x0_resize_q75_h2_box_3.webp 200w,/blog/opa-gatekeeper-openshift/nonsecure-route_hub1aa6be75d3487a19b298ae38ebb6c09_22483_300x0_resize_q75_h2_box_3.webp 300w,/blog/opa-gatekeeper-openshift/nonsecure-route_hub1aa6be75d3487a19b298ae38ebb6c09_22483_400x0_resize_q75_h2_box_3.webp 400w,/blog/opa-gatekeeper-openshift/nonsecure-route_hub1aa6be75d3487a19b298ae38ebb6c09_22483_500x0_resize_q75_h2_box_3.webp 500w" />
      
      <img
        src="/blog/opa-gatekeeper-openshift/nonsecure-route.png"
        srcset="/blog/opa-gatekeeper-openshift/nonsecure-route_hub1aa6be75d3487a19b298ae38ebb6c09_22483_100x0_resize_box_3.png 100w,/blog/opa-gatekeeper-openshift/nonsecure-route_hub1aa6be75d3487a19b298ae38ebb6c09_22483_200x0_resize_box_3.png 200w,/blog/opa-gatekeeper-openshift/nonsecure-route_hub1aa6be75d3487a19b298ae38ebb6c09_22483_300x0_resize_box_3.png 300w,/blog/opa-gatekeeper-openshift/nonsecure-route_hub1aa6be75d3487a19b298ae38ebb6c09_22483_400x0_resize_box_3.png 400w,/blog/opa-gatekeeper-openshift/nonsecure-route_hub1aa6be75d3487a19b298ae38ebb6c09_22483_500x0_resize_box_3.png 500w"
        alt="nonsecure_route"
        
        loading="lazy"
        width="676"
        height="420"
      />
    </picture>
  






</p>
<p>Some constraints are impossible to write without access to more state than just the object under test. For example, it is impossible to know if an route&rsquo;s hostname is unique among all routes unless a rule has access to all other routes. To make such rules possible, we enable syncing of data into OPA.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">config.gatekeeper.sh/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Config</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#e6db74">&#34;gatekeeper-system&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sync</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">syncOnly</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">group</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">version</span>: <span style="color:#e6db74">&#34;v1&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kind</span>: <span style="color:#e6db74">&#34;Namespace&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">group</span>: <span style="color:#e6db74">&#34;route.OpenShift.io&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">version</span>: <span style="color:#e6db74">&#34;v1&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kind</span>: <span style="color:#e6db74">&#34;Route&#34;</span>
</span></span></code></pre></div><p>Let&rsquo;s create another policy which prevents conflicting routes from being created</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">templates.gatekeeper.sh/v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ConstraintTemplate</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">k8suniqueroutehost</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">crd</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">names</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">K8sUniqueRouteHost</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">targets</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">target</span>: <span style="color:#ae81ff">admission.k8s.gatekeeper.sh</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">rego</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        package k8suniqueroutehost
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        identical(obj, review) {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          obj.metadata.namespace == review.object.metadata.namespace
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          obj.metadata.name == review.object.metadata.name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        violation[{&#34;msg&#34;: msg}] {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          input.review.kind.kind == &#34;Route&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          re_match(&#34;^(route.OpenShift.io)$&#34;, input.review.kind.group)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          host := input.review.object.spec.host
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          other := data.inventory.namespace[ns][otherapiversion][&#34;Route&#34;][name]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          re_match(&#34;^(route.OpenShift.io)/.+$&#34;, otherapiversion)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          other.spec.host == host
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          not identical(other, input.review)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          msg := sprintf(&#34;Route host conflicts with an existing route &lt;%v&gt;&#34;, [host])
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }</span>        
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">constraints.gatekeeper.sh/v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">K8sUniqueRouteHost</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">unique-route-host</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">match</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kinds</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;route.OpenShift.io&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kinds</span>: [<span style="color:#e6db74">&#34;Route&#34;</span>]
</span></span></code></pre></div><h2 id="resources">
  Resources
  <a href="#resources" class="post-heading__anchor" aria-hidden="true">#</a>
</h2>
<ul>
<li><a
  href="https://www.openpolicyagent.org/docs/latest/"
  
  
    class="link--external" target="_blank" rel="noreferrer"
  
>Open Policy Agent</a></li>
<li><a
  href="https://github.com/open-policy-agent/gatekeeper"
  
  
    class="link--external" target="_blank" rel="noreferrer"
  
>OPA Gatekeeper</a></li>
<li><a
  href="https://github.com/open-policy-agent/conftest"
  
  
    class="link--external" target="_blank" rel="noreferrer"
  
>Test framework</a></li>
</ul>

    </div>

    

    
  </article>

        </div>
        <div class="sidebar">
  

  
  
    <aside class="bio">
      

  <section class="jr__item jr-basics__item">
    
  <div class="jr-basics__image">
    <img
      src="https://raw.githubusercontent.com/Vikaspogu/blog/master/static/images/myAvatar.png"
      alt="Picture of Vikas Pogu"
      width="250"
      height="250"
    />
  </div>



    
      <div class="jr-basics__name">Vikas Pogu</div>
    

    
      <div class="jr-basics__label">Senior Consultant</div>
    

    
      <div class="jr-basics__email">vikaspoguadf@gmail.com</div>
    

    

    

    
      <div class="jr-basics__summary">Currently working as a Senior Consultant@Red Hat. Focusing on cloud technologies primarily OpenShift and kubernetes.</div>
    

    
      

      

      
        <div class="jr-basics__location-city">Rochester, Minnesota</div>
      

      

      
    

    
      <hr />
      <div class="jr-basics__profile jr-basics__profile--col">
        
          

<a href="https://github.com/Vikaspogu">

<div class="jr-basics__profile-item">
  <div class="jr-basics__profile-icon">
    
    <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
  </div>

  
    <div class="jr-basics__profile-username">vikaspogu</div>
  
</div>


</a>

        
      </div>
    

    
  </section>


    </aside>
  
</div>

      </main>
      <footer>
  <div class="copyright">
    
      Copyright © 2021
    
  </div>
</footer>



  







  
  


<script
  type="text/javascript"
  src="/js/main.dcd63d82dd0c74d9d5f2328aba99dda49ba95acfa94883553cd8fc004ae9f6fd3d12c159b12e17df64a8c94749e4d6639b769bde643094819ba7aa8078aedd3f.js"
  integrity="sha512-3NY9gt0MdNnV8jKKupndpJupWs&#43;pSINVPNj8AErp9v09EsFZsS4X32SoyUdJ5NZjm3ab3mQwlIGbp6qAeK7dPw==">
</script>

<script
  type="text/javascript"
  src="/js/flexsearch.0ce552103d9a536a8b7fc2e560e280bc96f43f1d016496e4aac8f4738d340b4cb1302c4be849a5999cd63d20a7c20e495047f439bdf683dbd7da67bd211aad3f.js"
  integrity="sha512-DOVSED2aU2qLf8LlYOKAvJb0Px0BZJbkqsj0c400C0yxMCxL6EmlmZzWPSCnwg5JUEf0Ob32g9vX2me9IRqtPw==">
</script>





    </div>
  </body>
</html>
